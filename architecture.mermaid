graph TB
    subgraph "React Native App (Expo)"
        subgraph "State Management (Zustand)"
            LocalStore["Local Store<br/>- pendingMessages<br/>- drafts<br/>- optimistic updates"]
            PresenceStore["Presence Store<br/>- presenceData<br/>- typingData<br/>- online/offline status"]
            FirebaseStore["Firebase Store<br/>- users<br/>- conversations<br/>- messages<br/>- source of truth"]
        end
        
        subgraph "Screens"
            Auth["Auth Screens<br/>- Signup<br/>- Login<br/>- Profile Setup"]
            Home["Home Screen<br/>- User List<br/>- Presence Indicators<br/>- Status Colors"]
            Chat["Chat Screen<br/>- Messages<br/>- Typing Indicators<br/>- Status: ✓ ✓✓ ✓✓"]
            Profile["Profile Screen<br/>- Edit Profile<br/>- Dark Mode Toggle"]
            Group["Group Screens<br/>- Create Group<br/>- Group Info<br/>- Add/Remove Members"]
            AI["AI Screens<br/>- Action Items<br/>- Decisions<br/>- Agent Chat"]
        end
        
        subgraph "AI Services"
            Summary["Thread<br/>Summarization"]
            ActionItems["Action Item<br/>Extraction"]
            Search["Semantic<br/>Search"]
            Priority["Priority<br/>Detection"]
            Decisions["Decision<br/>Tracking"]
            Agent["Multi-Step<br/>Agent"]
        end
    end
    
    subgraph "Firebase Services"
        Auth_FB["Firebase Auth<br/>Email/Password"]
        Firestore["Firestore<br/>- users collection<br/>- conversations<br/>- messages<br/>- offline persistence"]
        RealtimeDB["Realtime Database<br/>- /presence/{userId}<br/>- /typing/{convId}/{userId}<br/>- .onDisconnect()"]
        Storage["Firebase Storage<br/>- profile_photos<br/>- group_photos"]
        CloudFunc["Cloud Functions<br/>- sendMessageNotification<br/>- priority alerts"]
    end
    
    subgraph "AI Backend"
        OpenAI["OpenAI API<br/>- GPT-4 Turbo<br/>- text-embedding-3-small"]
        VercelAI["Vercel AI SDK<br/>- streamText<br/>- generateObject<br/>- tool calling"]
    end
    
    subgraph "Push Notifications"
        ExpoNotif["Expo Notifications<br/>- Request permission<br/>- Get push token"]
        FCM["Firebase Cloud<br/>Messaging"]
    end
    
    %% Connections
    Auth --> Auth_FB
    Home --> FirebaseStore
    Home --> PresenceStore
    Chat --> LocalStore
    Chat --> FirebaseStore
    Chat --> PresenceStore
    Profile --> FirebaseStore
    Profile --> Storage
    Group --> FirebaseStore
    AI --> Summary
    AI --> ActionItems
    AI --> Search
    AI --> Priority
    AI --> Decisions
    AI --> Agent
    
    LocalStore --> Firestore
    FirebaseStore --> Firestore
    PresenceStore --> RealtimeDB
    
    Summary --> VercelAI
    ActionItems --> VercelAI
    Search --> VercelAI
    Priority --> VercelAI
    Decisions --> VercelAI
    Agent --> VercelAI
    
    VercelAI --> OpenAI
    
    Firestore --> CloudFunc
    CloudFunc --> FCM
    ExpoNotif --> FCM
    
    %% Styling
    classDef storeStyle fill:#4A90E2,stroke:#2E5C8A,color:#fff
    classDef screenStyle fill:#50C878,stroke:#2E7D4E,color:#fff
    classDef aiStyle fill:#9B59B6,stroke:#6C3483,color:#fff
    classDef firebaseStyle fill:#FFA500,stroke:#CC8400,color:#fff
    classDef apiStyle fill:#E74C3C,stroke:#A93226,color:#fff
    
    class LocalStore,PresenceStore,FirebaseStore storeStyle
    class Auth,Home,Chat,Profile,Group,AI screenStyle
    class Summary,ActionItems,Search,Priority,Decisions,Agent aiStyle
    class Auth_FB,Firestore,RealtimeDB,Storage,CloudFunc firebaseStyle
    class OpenAI,VercelAI,ExpoNotif,FCM apiStyle